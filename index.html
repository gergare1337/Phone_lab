<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Phone_Lab — Apple Store style</title>
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700;800&display=swap" rel="stylesheet">
<style>
  :root{
    --bg: #f6f7f8;
    --panel: #ffffff;
    --muted: #6b7280;
    --text: #0b1220;
    --accent: #0071e3; /* apple-ish blue */
    --soft: rgba(11,18,32,0.06);
    --radius: 14px;
    --max-width: 1200px;
    --gap: 20px;
  }

  *{box-sizing:border-box}
  html,body{height:100%}
  body{
    margin:0;
    font-family: 'Inter', system-ui, -apple-system, "Segoe UI", Roboto, Arial;
    background: linear-gradient(180deg,var(--bg),#ffffff 30%);
    color:var(--text);
    -webkit-font-smoothing:antialiased;
    -moz-osx-font-smoothing:grayscale;
    display:flex;
    justify-content:center;
    padding:28px 18px;
  }

  .site {
    width:100%;
    max-width:var(--max-width);
  }

  /* Header */
  header.site-header {
    display:flex;
    align-items:flex-start;
    justify-content:space-between;
    gap:18px;
    margin-bottom:18px;
  }

  .brand {
    display:flex;
    flex-direction:column;
    gap:12px;
  }

  .brand-row {
    display:flex;
    align-items:center;
    gap:18px;
  }

  h1 {
    margin:0;
    font-size:20px;
    font-weight:700;
    letter-spacing:0.2px;
  }

  /* Top nav inline under title */
  nav.main-nav {
    display:flex;
    gap:8px;
    align-items:center;
  }
  nav.main-nav a {
    display:inline-block;
    padding:8px 12px;
    border-radius:10px;
    text-decoration:none;
    color:var(--muted);
    font-weight:600;
    transition: all .16s ease;
    border:1px solid transparent;
    background:transparent;
  }
  nav.main-nav a.active {
    color: white;
    background: linear-gradient(180deg,var(--accent), #005ecb);
    box-shadow: 0 8px 30px rgba(0,113,227,0.14);
  }

  /* Inline models row (sub-menu) */
  #sub-menu {
    display:flex;
    gap:10px;
    flex-wrap:wrap;
    margin-top:6px;
  }
  .sub-item {
    background:transparent;
    border-radius:10px;
    padding:8px 12px;
    color:var(--muted);
    border:1px solid transparent;
    cursor:pointer;
    font-weight:600;
    transition:all .12s ease;
  }
  .sub-item.active {
    color: var(--text);
    background: linear-gradient(180deg, rgba(0,0,0,0.02), rgba(0,0,0,0.01));
    border: 1px solid rgba(11,18,32,0.06);
    box-shadow: 0 6px 18px rgba(11,18,32,0.04);
  }

  /* Right controls: search + cart */
  .controls {
    display:flex;
    gap:12px;
    align-items:center;
  }

  .search {
    display:flex;
    align-items:center;
    gap:10px;
    background:var(--panel);
    padding:10px 14px;
    border-radius:999px;
    box-shadow: 0 6px 18px rgba(11,18,32,0.04);
    min-width:260px;
    max-width:480px;
  }
  .search input {
    border:0;
    outline:0;
    background:transparent;
    font-size:14px;
    width:220px;
  }
  .select {
    background:transparent;
    border-radius:10px;
    padding:8px 10px;
    border:1px solid rgba(11,18,32,0.04);
    cursor:pointer;
  }

  .icon-btn {
    display:inline-flex;
    align-items:center;
    justify-content:center;
    padding:10px;
    border-radius:10px;
    background:var(--panel);
    border:1px solid rgba(11,18,32,0.04);
    box-shadow: 0 6px 18px rgba(11,18,32,0.03);
    cursor:pointer;
    position:relative;
  }
  .cart-badge {
    position:absolute;
    right:-6px;
    top:-6px;
    background:#ff3b30;
    color:white;
    font-size:12px;
    padding:4px 8px;
    border-radius:999px;
    box-shadow:0 6px 18px rgba(255,59,48,0.12);
  }

  /* Info + actions row */
  .toolbar {
    display:flex;
    justify-content:space-between;
    align-items:center;
    gap:12px;
    margin:18px 0;
  }
  .info { color:var(--muted); font-size:14px }

  .reset-btn {
    background:transparent;
    border:1px solid rgba(11,18,32,0.04);
    padding:8px 12px;
    border-radius:10px;
    cursor:pointer;
    font-weight:600;
  }

  /* Products area - Apple-like big cards */
  .products {
    display:grid;
    grid-template-columns: repeat(3, 1fr);
    gap: var(--gap);
  }

  .product-card {
    background:var(--panel);
    border-radius:18px;
    padding:18px;
    box-shadow: 0 18px 40px rgba(11,18,32,0.04);
    display:flex;
    flex-direction:column;
    gap:14px;
    transition: transform .18s ease, box-shadow .18s ease;
    overflow:hidden;
  }
  .product-card:hover {
    transform: translateY(-6px);
    box-shadow: 0 28px 60px rgba(11,18,32,0.06);
  }

  .media {
    height:290px;
    display:flex;
    align-items:center;
    justify-content:center;
    border-radius:12px;
    background: linear-gradient(180deg,#f8fafb,#ffffff);
    box-shadow: inset 0 -1px 0 rgba(11,18,32,0.02);
    overflow:hidden;
  }
  .media img {
    max-width:78%;
    max-height:78%;
    object-fit:contain;
    transition: transform .25s ease;
  }
  .product-card:hover .media img { transform: scale(1.03); }

  .title {
    font-size:16px;
    font-weight:700;
    color:var(--text);
    min-height:44px;
  }
  .meta { color:var(--muted); font-size:13px; }
  .price {
    font-weight:800;
    color:var(--accent);
    font-size:18px;
  }

  .actions {
    display:flex;
    gap:12px;
    align-items:center;
    justify-content:space-between;
    margin-top:auto;
  }
  .btn-primary {
    background: linear-gradient(180deg,var(--accent), #005ecb);
    color:white;
    border:0;
    padding:10px 14px;
    border-radius:12px;
    cursor:pointer;
    font-weight:700;
    box-shadow: 0 10px 30px rgba(0,113,227,0.12);
  }
  .btn-outline {
    background:transparent;
    color:var(--text);
    border:1px solid rgba(11,18,32,0.06);
    padding:10px 14px;
    border-radius:12px;
    cursor:pointer;
    font-weight:700;
  }

  .empty {
    padding:36px;
    border-radius:12px;
    text-align:center;
    color:var(--muted);
    background:linear-gradient(180deg, rgba(0,0,0,0.01), rgba(0,0,0,0.005));
  }

  /* Cart panel (slide-in) */
  .cart-panel {
    position:fixed;
    right:22px;
    top:86px;
    width:380px;
    max-height:72vh;
    overflow:auto;
    background:var(--panel);
    border-radius:16px;
    box-shadow: 0 40px 120px rgba(2,6,23,0.22);
    padding:16px;
    display:none;
    z-index:1500;
  }
  .cart-item { display:flex; gap:12px; align-items:center; padding:12px 0; border-bottom:1px dashed rgba(11,18,32,0.04); }
  .cart-item img { width:80px; height:80px; object-fit:cover; border-radius:10px; background:#f3f4f6; }
  .ci-name { font-weight:700; font-size:14px }
  .ci-price { color:var(--accent); font-weight:800 }

  /* responsive */
  @media (max-width:1000px){
    .products { grid-template-columns: repeat(2, 1fr); }
    .media { height:220px; }
    .search input { width:140px; }
  }
  @media (max-width:640px){
    header.site-header { flex-direction:column; align-items:flex-start; gap:12px; }
    .products { grid-template-columns: 1fr; }
    .media { height:180px; }
    .cart-panel { left:12px; right:12px; width:auto; top:70px; }
    .search input { width:90px; }
  }

  /* small UI niceties */
  .visually-hidden { position:absolute; left:-9999px; top:auto; width:1px; height:1px; overflow:hidden; }
  button:active { transform: translateY(1px); }
</style>
</head>
<body>
  <div class="site">

    <!-- Header -->
    <header class="site-header" role="banner">
      <div class="brand">
        <div class="brand-row">
          <h1>Phone_Lab</h1>

          <nav class="main-nav" id="main-nav" aria-label="Категории">
            <a href="#" data-cat="sim" class="active">iPhone SIM</a>
            <a href="#" data-cat="esim">iPhone eSIM</a>
            <a href="#" data-cat="accessories">Аксессуары</a>
          </nav>
        </div>

        <!-- models inline under brand -->
        <div id="sub-menu" aria-label="Модели"></div>
      </div>

      <div class="controls" role="region" aria-label="Поиск и корзина">
        <div class="search" role="search" aria-label="Поиск товаров">
          <svg width="18" height="18" viewBox="0 0 24 24" fill="none" aria-hidden="true">
            <path d="M21 21l-4.35-4.35" stroke="#6b7280" stroke-width="1.6" stroke-linecap="round"/>
            <circle cx="11" cy="11" r="6" stroke="#6b7280" stroke-width="1.6"/>
          </svg>
          <input id="search" placeholder="Поиск: модель, цвет, объём" aria-label="Поиск товаров">
        </div>

        <select id="sort" class="select" aria-label="Сортировка">
          <option value="">Сортировка</option>
          <option value="price-asc">Цена ↑</option>
          <option value="price-desc">Цена ↓</option>
          <option value="name-asc">Название A→Z</option>
        </select>

        <button id="cart-toggle" class="icon-btn" aria-label="Открыть корзину">
          <svg width="20" height="20" viewBox="0 0 24 24" fill="none" aria-hidden="true">
            <path d="M3 3h2l.4 2M7 13h10l4-8H5.4" stroke="#0b1220" stroke-width="1.4" stroke-linecap="round" stroke-linejoin="round"/>
          </svg>
          <div id="cart-count" class="cart-badge" style="display:none">0</div>
        </button>
      </div>
    </header>

    <!-- toolbar -->
    <div class="toolbar" role="toolbar" aria-label="Инструменты">
      <div class="info" id="current-info">Выберите категорию и модель</div>
      <div>
        <button id="reset" class="reset-btn">Сброс</button>
      </div>
    </div>

    <!-- products -->
    <main>
      <div id="products" class="products" aria-live="polite"></div>
      <div id="empty" class="empty" style="display:none">Товары не найдены</div>
    </main>

    <!-- cart panel -->
    <aside id="cart-panel" class="cart-panel" aria-hidden="true">
      <h3>Корзина</h3>
      <div id="cart-items"></div>
      <div style="display:flex;justify-content:space-between;align-items:center;margin-top:12px">
        <div><strong>Итого:</strong> <span id="cart-total">0 ₽</span></div>
        <div style="display:flex;gap:8px">
          <button id="clear-cart" class="btn-outline">Очистить</button>
          <button id="checkout" class="btn-primary">Оформить</button>
        </div>
      </div>
    </aside>

    <footer style="margin-top:28px;color:var(--muted);font-size:13px;text-align:center">
      © Phone_Lab — демо-каталог. Положи реальные изображения в папку <code>images/</code>.
    </footer>
  </div>

<script>
/* -------------------- CATALOG -------------------- */
/* Подставь реальные пути в поле img (например "images/13-128-white.jpg") */
const catalog = {
  accessories: [
    { name: "Блок 20W", price: "2 000 ₽", img: "images/acc-20w.jpg" },
    { name: "AirPods 4", price: "11 000 ₽", img: "images/air4.jpg" },
    { name: "AirPods Pro 2", price: "17 000 ₽", img: "images/airpro2.jpg" }
  ],
  sim: {
    "iPhone 13": [
      { name: "13 128Gb White", price: "39 000 ₽", img: "images/13-128-white.jpg" },
      { name: "13 128Gb Black", price: "39 000 ₽", img: "images/13-128-black.jpg" },
      { name: "13 128Gb Blue", price: "39 000 ₽", img: "images/13-128-blue.jpg" }
    ],
    "iPhone 14": [
      { name: "14 128Gb Black", price: "43 000 ₽", img: "images/14-128-black.jpg" },
      { name: "14 256Gb White", price: "53 000 ₽", img: "images/14-256-white.jpg" }
    ],
    "iPhone 15": [
      { name: "15 128Gb Black", price: "47 000 ₽", img: "images/15-128-black.jpg" }
    ]
  },
  esim: {
    "iPhone 16": [
      { name: "16 128Gb Black", price: "56 000 ₽", img: "images/16-128-black.jpg" },
      { name: "16 256Gb White", price: "63 000 ₽", img: "images/16-256-white.jpg" }
    ],
    "iPhone 17": [
      { name: "17 256Gb Black", price: "75 000 ₽", img: "images/17-256-black.jpg" }
    ]
  }
};

/* -------------------- HELPERS -------------------- */
const $ = s => document.querySelector(s);
const $$ = s => Array.from(document.querySelectorAll(s));
const toNum = str => Number(String(str).replace(/\D/g,'')) || 0;
const fmtPrice = n => n.toString().replace(/\B(?=(\d{3})+(?!\d))/g, " ") + " ₽";

/* -------------------- STATE -------------------- */
let currentCategory = 'sim';
let currentModel = null;
let displayed = [];
let cart = JSON.parse(localStorage.getItem('ph_cart') || '[]');

/* -------------------- ELs -------------------- */
const mainNav = $('#main-nav');
const subMenu = $('#sub-menu');
const productsEl = $('#products');
const emptyEl = $('#empty');
const currentInfo = $('#current-info');
const searchInput = $('#search');
const sortSelect = $('#sort');
const resetBtn = $('#reset');
const cartToggle = $('#cart-toggle');
const cartCount = $('#cart-count');
const cartPanel = $('#cart-panel');
const cartItems = $('#cart-items');
const cartTotal = $('#cart-total');
const clearCart = $('#clear-cart');
const checkout = $('#checkout');

/* -------------------- RENDER SUBMENU -------------------- */
function renderMain() {
  // set active on main nav
  $$('#main-nav a').forEach(a => a.classList.toggle('active', a.dataset.cat === currentCategory));
  // clear sub-menu
  subMenu.innerHTML = '';
  currentModel = null;

  if(currentCategory === 'accessories') {
    currentInfo.textContent = 'Аксессуары';
    renderProducts(catalog.accessories);
    return;
  }

  const models = catalog[currentCategory] || {};
  const keys = Object.keys(models);
  if(!keys.length) {
    productsEl.innerHTML = '';
    emptyEl.style.display = 'block';
    currentInfo.textContent = 'Нет моделей';
    return;
  }

  keys.forEach((k, i) => {
    const el = document.createElement('button');
    el.className = 'sub-item';
    el.textContent = k;
    el.type = 'button';
    el.addEventListener('click', () => {
      subMenu.querySelectorAll('.sub-item').forEach(x => x.classList.remove('active'));
      el.classList.add('active');
      currentModel = k;
      currentInfo.textContent = `${k} (${currentCategory})`;
      renderProducts(models[k]);
    });
    subMenu.appendChild(el);
    if(i === 0) setTimeout(()=> el.click(), 10);
  });
}

/* -------------------- RENDER PRODUCTS -------------------- */
function renderProducts(list) {
  displayed = Array.isArray(list) ? list.slice() : [];
  applyFilters();
}

function applyFilters() {
  const q = (searchInput.value || '').trim().toLowerCase();
  let filtered = displayed.filter(i => (i.name + ' ' + (i.price||'')).toLowerCase().includes(q));
  const s = sortSelect.value;
  if(s === 'price-asc') filtered.sort((a,b)=> toNum(a.price) - toNum(b.price));
  if(s === 'price-desc') filtered.sort((a,b)=> toNum(b.price) - toNum(a.price));
  if(s === 'name-asc') filtered.sort((a,b)=> a.name.localeCompare(b.name,'ru'));

  productsEl.innerHTML = '';
  if(!filtered.length) {
    emptyEl.style.display = 'block';
    return;
  } else {
    emptyEl.style.display = 'none';
  }

  filtered.forEach(item => {
    const card = document.createElement('article');
    card.className = 'product-card';
    card.innerHTML = `
      <div class="media">
        <img loading="lazy" src="${item.img}" alt="${item.name}">
      </div>
      <div class="title">${item.name}</div>
      <div class="meta">Категория: ${currentCategory}</div>
      <div class="price">${item.price}</div>
      <div class="actions">
        <button class="btn-outline add">В корзину</button>
        <button class="btn-primary buy">Купить</button>
      </div>
    `;
    // image fallback
    const img = card.querySelector('img');
    img.onerror = () => { img.src = 'images/placeholder.jpg'; img.alt = 'placeholder'; };

    card.querySelector('.add').addEventListener('click', () => { addToCart(item); animateBadge(); });
    card.querySelector('.buy').addEventListener('click', () => { addToCart(item); openCart(); });

    productsEl.appendChild(card);
  });
}

/* -------------------- CART -------------------- */
function saveCart() {
  localStorage.setItem('ph_cart', JSON.stringify(cart));
  updateCartUI();
}
function cartCount() { return cart.reduce((s,i)=> s + (i.qty||1), 0); }

function updateCartUI() {
  const cnt = cartCount();
  if(cnt > 0) { cartCount.style.display = 'block'; cartCount.textContent = cnt; } else cartCount.style.display = 'none';

  cartItems.innerHTML = '';
  if(!cart.length) {
    cartItems.innerHTML = '<div style="color:var(--muted);padding:8px">Корзина пуста</div>';
    cartTotal.textContent = '0 ₽';
    return;
  }
  let total = 0;
  cart.forEach((c, idx) => {
    const priceN = toNum(c.price);
    total += priceN * c.qty;
    const node = document.createElement('div');
    node.className = 'cart-item';
    node.innerHTML = `
      <img src="${c.img}" alt="${c.name}">
      <div style="flex:1">
        <div class="ci-name">${c.name}</div>
        <div class="ci-price">${c.price}</div>
        <div style="display:flex;gap:8px;margin-top:8px;align-items:center">
          <button class="decr" data-i="${idx}">−</button>
          <div style="min-width:26px;text-align:center">${c.qty}</div>
          <button class="incr" data-i="${idx}">+</button>
          <button class="remove" data-i="${idx}">Удалить</button>
        </div>
      </div>
    `;
    const im = node.querySelector('img');
    im.onerror = () => im.src = 'images/placeholder.jpg';
    cartItems.appendChild(node);
  });
  cartTotal.textContent = fmtPrice(total);

  // attach handlers
  $$('.incr').forEach(b => b.addEventListener('click', ()=> { const i=+b.dataset.i; cart[i].qty+=1; saveCart(); }));
  $$('.decr').forEach(b => b.addEventListener('click', ()=> { const i=+b.dataset.i; cart[i].qty-=1; if(cart[i].qty<=0) cart.splice(i,1); saveCart(); }));
  $$('.remove').forEach(b => b.addEventListener('click', ()=> { const i=+b.dataset.i; cart.splice(i,1); saveCart(); }));
}

function addToCart(item) {
  const idx = cart.findIndex(c => c.name === item.name && c.price === item.price);
  if(idx >= 0) cart[idx].qty += 1;
  else cart.push({ name: item.name, price: item.price, img: item.img, qty: 1 });
  saveCart();
}

function openCart() {
  cartPanel.style.display = 'block';
  cartPanel.setAttribute('aria-hidden','false');
}
function closeCart(){
  cartPanel.style.display = 'none';
  cartPanel.setAttribute('aria-hidden','true');
}

/* -------------------- INTERACTIONS -------------------- */
function animateBadge(){
  if(cartCount.style.display !== 'none') {
    cartCount.animate([{ transform:'scale(1)' },{ transform:'scale(1.12)' },{ transform:'scale(1)'}], { duration:240 });
  }
  cartToggle.animate([{ transform:'scale(1)' },{ transform:'scale(1.04)' },{ transform:'scale(1)'}], { duration:240 });
}

/* global listeners */
$$('#main-nav a').forEach(a => a.addEventListener('click', e => {
  e.preventDefault();
  currentCategory = a.dataset.cat;
  renderMain();
}));

searchInput.addEventListener('input', () => applyFilters());
sortSelect.addEventListener('change', () => applyFilters());
resetBtn.addEventListener('click', () => { searchInput.value=''; sortSelect.value=''; renderMain(); });

cartToggle.addEventListener('click', () => {
  if(cartPanel.style.display === 'block') closeCart(); else openCart();
});
clearCart.addEventListener('click', () => { cart = []; saveCart(); });
checkout.addEventListener('click', () => {
  if(!cart.length) { alert('Корзина пуста.'); return; }
  alert('Заказ оформлен (демо). Сумма: ' + cartTotal.textContent);
  cart = []; saveCart(); closeCart();
});

// click outside to close cart
document.addEventListener('click', (e) => {
  if(cartPanel.style.display === 'block' && !cartPanel.contains(e.target) && !cartToggle.contains(e.target)) {
    closeCart();
  }
});

// init
renderMain();
updateCartUI();
applyFilters();
</script>
</body>
</html>
